# -*- mode: yaml -*-

manifest:
  version: 1.0

automations:
  review_new_terraform_module:
    if:
      - {{ terraform }}
      - {{ test_list }}
      - {{tffilesnotinpr}}
      - {{ newfilesinpr }}
      - {{ branch.diff.files_metadata }}
      - {{ tffilesnotinpr | match(regex=r/\.tf$/) | every}}
    run:
      - action: add-comment@v1
        args:
          comment: "{{terraform}} - {{newfilesinpr}} - {{test_list}} - {{tffilesnotinpr}}"

resources:
  module_directory: 'modules'
terraform:
  - main.tf
  - outputs.tf
  - providers.tf
test_list:
  - main.tf
  - outputs.tf
newfilesinpr:
  {{ branch.diff.files_metadata | map(attr='new_file')}}
tffilesnotinpr:
  {{ terraform | reject(list=test_list) }}
